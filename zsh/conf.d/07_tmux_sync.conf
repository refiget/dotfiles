# ============================================================
# Tmux mode sync (colors only; no cursor output)
# ============================================================
if [[ -n "$TMUX" ]]; then
  tmux set-environment -g TMUX_MODE insert >/dev/null 2>&1
  tmux run-shell -b "~/.config/tmux/scripts/update_theme_color.sh" >/dev/null 2>&1
fi

_tmux_mode_sync() {
  [[ -z "$TMUX" ]] && return
  local km="${1:-$KEYMAP}"
  # Invert logic so colors match Bob's preference:
  #   normal-mode (vicmd) -> purple
  #   insert-mode (viins) -> green
  # update_theme_color.sh uses TMUX_MODE==insert => purple, else => base (green)
  local mode="normal"
  [[ "$km" == "vicmd" ]] && mode="insert"
  tmux set-environment -g TMUX_MODE "$mode" >/dev/null 2>&1
  tmux run-shell -b "~/.config/tmux/scripts/update_theme_color.sh" >/dev/null 2>&1
  tmux refresh-client -S >/dev/null 2>&1
}
autoload -Uz add-zsh-hook
zle -N zle-keymap-select _tmux_mode_sync
zle -N zle-line-init _tmux_mode_sync
add-zsh-hook precmd _tmux_mode_sync
