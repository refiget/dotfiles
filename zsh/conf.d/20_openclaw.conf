# ============================================================
# OpenClaw helpers (TUI + pipe-friendly messaging)
#
# Usage:
#   oc <name>            -> open TUI for agent:main:<name>
#   oc <name> -m "..."    -> send one-shot message
#   cat file | oc <name> -> send piped content as message
#
# Convenience aliases:
#   ocstudy / ocwork (pipe-aware)
#   ocstudymsg / ocworkmsg (explicit message mode)
# ============================================================

# Core session id builder (keep stable naming)
_oc_session_id() {
  local name="$1"
  echo "agent:main:${name}"
}

# Send message to a session (stdin or argument)
_oc_send() {
  local name="$1"; shift
  local sid; sid="$(_oc_session_id "$name")"

  local msg=""

  if [[ "$1" == "-m" ]]; then
    shift
    msg="$*"
  elif [[ -t 0 ]]; then
    # no pipe, no -m
    echo "oc: no input; use: oc ${name} (TUI) or oc ${name} -m \"...\"" >&2
    return 1
  else
    # piped
    msg="$(cat)"
  fi

  # Avoid sending empty messages
  if [[ -z "$msg" ]]; then
    echo "oc: empty message (skipped)" >&2
    return 0
  fi

  openclaw agent --session-id "$sid" -m "$msg"
}

# Main entry: open TUI if interactive; otherwise send message
oc() {
  local name="$1"; shift || true
  if [[ -z "$name" ]]; then
    echo "Usage: oc <session_name>" >&2
    return 1
  fi

  # Explicit message mode
  if [[ "${1:-}" == "-m" ]]; then
    _oc_send "$name" -m "${*:2}"
    return $?
  fi

  # Pipe-friendly mode
  if [[ -t 0 ]]; then
    openclaw tui --session "$(_oc_session_id "$name")"
  else
    _oc_send "$name"
  fi
}

# Short aliases: oc+<name>
# (Alias expands to function call, so pipe works: cat x | ocstudy)
alias ocstudy='oc study'
alias ocwork='oc work'

# Explicit one-shot message helpers (avoid accidental TUI)
alias ocstudymsg='openclaw agent --session-id "agent:main:study" -m'
alias ocworkmsg='openclaw agent --session-id "agent:main:work" -m'
