# ============================================================
# Basic Environment & PATH (from reference .zshrc)
# ============================================================

# 1. å¼€å¯å˜é‡åŠ¨æ€åˆ·æ–° (å…³é”®ï¼šè®© Vim å’Œ Venv èƒ½å¤Ÿå®žæ—¶å˜åŒ–)
setopt PROMPT_SUBST  # è‡ªåŠ¨æ›¿æ¢ç‰¹æ®Šå­—ç¬¦

setopt HIST_IGNORE_ALL_DUPS
setopt HIST_IGNORE_SPACE
setopt HIST_REDUCE_BLANKS
setopt HIST_VERIFY
HISTSIZE=5000
SAVEHIST=5000
HISTFILE=~/.zsh_history

# Better cross-pane history (interactive only)
if [[ -o interactive ]]; then
  setopt INC_APPEND_HISTORY
  setopt SHARE_HISTORY
  setopt HIST_EXPIRE_DUPS_FIRST
  setopt HIST_FCNTL_LOCK
fi

setopt CORRECT
setopt AUTO_CD
setopt INTERACTIVE_COMMENTS

# ðŸŒ OS Detection
os_name=$(uname -s)
is_macos=false
is_linux=false
case "$os_name" in
  Darwin) is_macos=true ;;
  Linux)  is_linux=true ;;
esac

# PATH è®¾ç½®
typeset -U path PATH
path=(
  "$HOME/.local/bin"
  "/usr/local/bin"
  "/usr/bin"
  "/bin"
  "/usr/sbin"
  "/sbin"
  $path
)

# Mac: Homebrew shellenv
if [[ -f /opt/homebrew/bin/brew ]]; then
  eval "$(/opt/homebrew/bin/brew shellenv)"
fi
# (ImageMagick removed; no DYLD_* overrides)
# Linux pacman é¢å¤–è·¯å¾„
if $is_linux && command -v pacman >/dev/null 2>&1; then
  export PATH="/usr/local/sbin:/usr/local/bin:$PATH"
fi

# Enforce stable PATH priority (avoid font/term injected paths taking precedence)
# Keep user tools + Homebrew first, then fall back to whatever the OS injected.
if [[ -n "${path[*]:-}" ]]; then
  local -a __preferred __newpath
  __preferred=(
    "$HOME/.local/bin"
    "/opt/homebrew/bin"
    "/opt/homebrew/sbin"
    "/usr/local/bin"
  )

  __newpath=()
  local p
  for p in "${__preferred[@]}"; do
    [[ -d "$p" ]] && __newpath+=("$p")
  done

  for p in "${path[@]}"; do
    case "$p" in
      "$HOME/.local/bin"|"/opt/homebrew/bin"|"/opt/homebrew/sbin"|"/usr/local/bin")
        ;; # already handled
      *)
        __newpath+=("$p")
        ;;
    esac
  done

  path=("${__newpath[@]}")
fi

export EDITOR="nvim"
export VISUAL="nvim"
export PAGER="less"

autoload -U colors && colors
