# ============================================================
# Cursor shape for vi-mode
#   insert/main: bar
#   vicmd: block
#
# NOTE:
# Use ZLE hooks (add-zle-hook-widget) instead of overriding
# zle-keymap-select/zle-line-init directly, so Pure's own vi-mode
# prompt symbol updates keep working.
# ============================================================
[[ -o interactive ]] || return

autoload -Uz add-zle-hook-widget

__cursor_block() { print -n -- $'\e[2 q' }
__cursor_bar()   { print -n -- $'\e[6 q' }

__cursor_on_keymap_select() {
  case ${KEYMAP:-main} in
    vicmd) __cursor_block ;;
    *)     __cursor_bar ;;
  esac
}

__cursor_on_line_init() {
  __cursor_bar
}

__cursor_on_line_finish() {
  __cursor_bar
}

# Idempotent registration: avoid duplicate hooks on repeated `source ~/.zshrc`
add-zle-hook-widget -D keymap-select __cursor_on_keymap_select 2>/dev/null
add-zle-hook-widget -D line-init     __cursor_on_line_init 2>/dev/null
add-zle-hook-widget -D line-finish   __cursor_on_line_finish 2>/dev/null

add-zle-hook-widget keymap-select __cursor_on_keymap_select
add-zle-hook-widget line-init     __cursor_on_line_init
add-zle-hook-widget line-finish   __cursor_on_line_finish
