# ============================================================
# Init Checks & compile
# ============================================================
# 依赖自检（保守提示，不改现有功能/UI）
if ! command -v node >/dev/null 2>&1; then
  if $is_linux; then
    print "⚠️  未检测到 node，部分工具可能不可用。Arch: pacman -S nodejs npm"
  elif $is_macos; then
    print "⚠️  未检测到 node，部分工具可能不可用。macOS: brew install node"
  else
    print "⚠️  未检测到 node，部分工具可能不可用。"
  fi
fi

if ! command -v npm >/dev/null 2>&1 && ! command -v pnpm >/dev/null 2>&1 && ! command -v yarn >/dev/null 2>&1; then
  if $is_linux; then
    print "⚠️  未检测到 npm/pnpm/yarn，无法安装 js 依赖。Arch: pacman -S npm"
  elif $is_macos; then
    print "⚠️  未检测到 npm/pnpm/yarn，无法安装 js 依赖。macOS: brew install node"
  else
    print "⚠️  未检测到 npm/pnpm/yarn，无法安装 js 依赖。"
  fi
fi

if ! command -v python3 >/dev/null 2>&1; then
  if $is_linux; then
    print "⚠️  未检测到 python3，nvim python host 可能不可用。Arch: pacman -S python"
  elif $is_macos; then
    print "⚠️  未检测到 python3，nvim python host 可能不可用。macOS: brew install python"
  else
    print "⚠️  未检测到 python3，nvim python host 可能不可用。"
  fi
fi

if ! command -v fzf >/dev/null 2>&1; then
  if $is_linux; then
    print "⚠️  未检测到 fzf，fzf-tab 等功能不可用。Arch: pacman -S fzf"
  elif $is_macos; then
    print "⚠️  未检测到 fzf，fzf-tab 等功能不可用。macOS: brew install fzf"
  else
    print "⚠️  未检测到 fzf，fzf-tab 等功能不可用。"
  fi
fi

# zcompile moved to the dotfiles loader (~/dotfiles/.zshrc) so we compile the correct file.

# Avoid noisy/heavy banners on SSH sessions, and only run when stdout is a real TTY
# Local-only: do not run on SSH
if [[ -o interactive && -t 1 && -z "${SSH_CONNECTION:-}" && -z "${SSH_TTY:-}" ]]; then
  if command -v fastfetch >/dev/null; then
    fastfetch --show-errors
  fi
fi
