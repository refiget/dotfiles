# -- toggle_sync_input
bind C-g if-shell '[[ $(tmux showw synchronize-panes | cut -d\  -f2) == "on" ]]' \
'setw synchronize-panes off; set -g pane-border-style fg=#{?#{!=:#{environ:TMUX_THEME_COLOR},},#{environ:TMUX_THEME_COLOR},#b294bb}' \
'setw synchronize-panes on; set -g pane-border-style fg=red'

# -- theme
if-shell 'uname | grep -q Darwin' {
  run-shell "~/.config/tmux/scripts/update_theme_color.sh"
  # Pane-top UI is disabled to reduce visual split noise.
  setw -g pane-border-status off
  # Subtle split lines + clear focus using active border only.
  set -g pane-border-style fg=#313244
  set -g pane-active-border-style fg=#{@theme_color}

  set -g status-style "bg=default,fg=#c5c8c6"
  # Center the tab strip for a more "browser tabs" feel
  set -g status-justify 'centre'
  set -g status-left-length 90
  set -g status-right-length 140
  # Status refresh: dynamic. See scripts/pomo_refresh_interval.sh
  # - 1s while pomodoro is active
  # - 2s otherwise
  run-shell -b '~/.config/tmux/scripts/pomo_refresh_interval.sh'

  # UI constants (Catppuccin Mocha-ish palette)
  # backgrounds
  set -g @tab_bg "#1e1e2e"   # base
  # foregrounds
  set -g @tab_text "#cdd6f4"     # text
  set -g @tab_subtext "#a6adc8"  # subtext0
  set -g @tab_overlay "#6c7086"  # overlay0

  # Window list (tabs): clear boundaries + consistent padding
  # Use a Catppuccin Mocha divider tone (surface0) to match Neovim splits.
  setw -g window-status-separator '#[fg=#313244] │ #[default]'
  set -g window-status-style "bg=default"
  # Current tab sets its own bg; keep style default to avoid leaking bg to other segments.
  set -g window-status-current-style "bg=default"

  # Inactive tabs: truncated + subdued
  # Add a special style for the *last* window (window_last_flag) to aid quick toggling.
  # Last tab: use a very subtle background (more "tab UI" than underline)
  # Last tab: keep it subtle but in the same palette as the active tab
  set -g window-status-last-style 'fg=#{@tab_text},bg=#{@tab_bg}'
  # Typography: deemphasize the index, keep the name readable
  setw -g window-status-format '#[fg=#{@tab_overlay}]  #I:#[fg=#{@tab_subtext}]#{=16:#{window_name}}#{?window_activity_flag,#[fg=#ffb86c] •#[fg=#{@tab_subtext}],}#{?window_bell_flag,#[fg=#ff5555,bold] !#[fg=#{@tab_subtext}],}#{?window_zoomed_flag,#[fg=#{@theme_color},bold] Z#[fg=#{@tab_subtext}],}  '

  # Active tab: marker + window name + badges (no cwd)
  # Typography: deemphasize index inside the pill; keep the name as the focus.
  # NOTE: avoid combining ",bold" inside the same #[..] block; on some tmux builds it can leak as literal text.
  # Active tab should be static (no mode accent); focus comes from shape + contrast.
  # Active tab: a calm pill. Keep one primary emphasis (bg + arrow), everything else subtle.
  setw -g window-status-current-format '#[fg=#{@tab_text},bg=#{@tab_bg}]  ▸ #[fg=#{@tab_overlay},bg=#{@tab_bg}]#I:#[fg=#{@tab_text},bg=#{@tab_bg}]#{=18:#{window_name}}#{?window_active,,#{?window_activity_flag,#[fg=#ffb86c,bg=#{@tab_bg}] •,}}#{?window_active,,#{?window_bell_flag,#[fg=#ff5555,bg=#{@tab_bg}] !,}}#{?window_zoomed_flag,#[fg=#{@tab_text},bg=#{@tab_bg}] Z,}  #[default]'

  # Activity/bell: use foreground cues (avoid dark background blocks on transparent themes)
  setw -g window-status-activity-style "fg=#ffb86c"
  setw -g window-status-bell-style "fg=#ff5555,bold"
  set-option -g status-left "#(~/.config/tmux/tmux-status/left.sh)  "
  # Right side: keep it stable (no conditional segments that shift centering)
  set-option -g status-right "#(~/.config/tmux/tmux-status/right.sh)"

  # Pomodoro: start 30min timer (Shortcut) and show breathing dot until it ends
  # Uses @pomo_until_epoch (unix seconds). Shortcut name: 30min Timer(confetti)
  bind-key t run-shell -b 'tmux set -g @pomo_until_epoch "$(( $(date +%s) + 1800 ))"; ~/.config/tmux/scripts/pomo_refresh_interval.sh; shortcuts run "30min Timer(confetti)" >/dev/null 2>&1 || true; tmux refresh-client -S; (sleep 1801; ~/.config/tmux/scripts/pomo_refresh_interval.sh; tmux refresh-client -S) >/dev/null 2>&1 &'
  bind-key T run-shell -b 'tmux set -gu @pomo_until_epoch >/dev/null 2>&1 || true; ~/.config/tmux/scripts/pomo_refresh_interval.sh; tmux refresh-client -S'

} {
  run-shell "~/.config/tmux/scripts/update_theme_color.sh"

  setw -g pane-border-status off
  set -g pane-border-style fg=colour244

  set -g status-style "bg=default,fg=#c5c8c6"
  set -g status-justify 'left'
  set -g status-left-length 90
  set -g status-right-length 0
  setw -g window-status-separator ''
  set -g window-status-style "bg=default"
  set -g window-status-current-style "bg=default"
  setw -g window-status-format '#[fg=#c5c8c6] #I:#W '
  setw -g window-status-current-format '#[fg=#{@theme_color},bold] #I:#W '
  setw -g window-status-activity-style "fg=#{@theme_color}"
  setw -g window-status-bell-style "fg=#ff5555"
  set-option -g status-left "#(~/.config/tmux/tmux-status/left.sh) "
  set-option -g status-right ""

  unbind -n M-v
  # Keep Meta/Alt hjkl pane navigation bindings (defined in 06_pane_navigation.conf)
  bind v copy-mode \; send-keys -X begin-selection
  bind V copy-mode \; send-keys -X rectangle-toggle
  bind P run-shell "~/.config/tmux/scripts/paste_from_clipboard.sh"
}
