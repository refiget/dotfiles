# -- toggle_sync_input
bind C-g if-shell '[[ $(tmux showw synchronize-panes | cut -d\  -f2) == "on" ]]' \
'setw synchronize-panes off; set -g pane-border-style fg=#{?#{!=:#{environ:TMUX_THEME_COLOR},},#{environ:TMUX_THEME_COLOR},#b294bb}' \
'setw synchronize-panes on; set -g pane-border-style fg=red'

# -- theme
if-shell 'uname | grep -q Darwin' {
  run-shell "~/.config/tmux/scripts/update_theme_color.sh"
  setw -g pane-border-status top
  set -g pane-border-style fg=colour244
  setw -g pane-border-format '#{?pane_active,#[fg=#{@theme_color}]#( ~/.config/tmux/scripts/pane_starship_title.sh #{pane_pid} #{pane_width} "#{pane_current_path}" "#{pane_current_command}" ),#[fg=colour244]#( ~/.config/tmux/scripts/pane_starship_title.sh #{pane_pid} #{pane_width} "#{pane_current_path}" "#{pane_current_command}" )}'

  set -g status-style "bg=default,fg=#c5c8c6"
  set -g status-justify 'left'
  set -g status-left-length 90
  set -g status-right-length 140
  # Window list (tabs): clear boundaries + consistent padding
  # Put the *path* (basename) where the window title normally is, for the active tab.
  setw -g window-status-separator ' · '
  set -g window-status-style "bg=default"
  set -g window-status-current-style "bg=default"

  # Inactive tabs: window name, subtle + truncated for stability
  # Use tmux's width truncation: #{=N:<format>}
  setw -g window-status-format '#[fg=colour244]  #I:#{=18:#{window_name}}#F  '

  # Active tab: marker + index + basename(path) + window flags, with truncation
  # - #{b:pane_current_path}: basename of active pane cwd for that window
  # - #{=22:...}: truncate to keep the bar stable
  # - #F: window flags (zoom, activity, etc.)
  setw -g window-status-current-format '#[fg=#{@theme_color},bg=#2e3440,bold]  ▸ #I:#{=22:#{b:pane_current_path}}#F  #[default]'

  # Activity/bell: use foreground cues (avoid dark background blocks on transparent themes)
  setw -g window-status-activity-style "fg=#ffb86c"
  setw -g window-status-bell-style "fg=#ff5555,bold"
  set-option -g status-left "#(~/.config/tmux/tmux-status/left.sh)   "
  # Right side: show COPY when in copy-mode (pane_in_mode) + keep existing segments
  set-option -g status-right '#{?#{==:#{pane_in_mode},1},#[fg=#ffb86c,bold] COPY #[default],}#(~/.config/tmux/tmux-status/right.sh)'

} {
  run-shell "~/.config/tmux/scripts/update_theme_color.sh"

  setw -g pane-border-status off
  set -g pane-border-style fg=colour244

  set -g status-style "bg=default,fg=#c5c8c6"
  set -g status-justify 'left'
  set -g status-left-length 90
  set -g status-right-length 0
  setw -g window-status-separator ''
  set -g window-status-style "bg=default"
  set -g window-status-current-style "bg=default"
  setw -g window-status-format '#[fg=#c5c8c6] #I:#W '
  setw -g window-status-current-format '#[fg=#{@theme_color},bold] #I:#W '
  setw -g window-status-activity-style "fg=#{@theme_color}"
  setw -g window-status-bell-style "fg=#ff5555"
  set-option -g status-left "#(~/.config/tmux/tmux-status/left.sh) "
  set-option -g status-right ""

  unbind -n M-v
  unbind -n M-h
  unbind -n M-j
  unbind -n M-k
  unbind -n M-l
  bind v copy-mode \; send-keys -X begin-selection
  bind V copy-mode \; send-keys -X rectangle-toggle
  bind P run-shell "~/.config/tmux/scripts/paste_from_clipboard.sh"
}
