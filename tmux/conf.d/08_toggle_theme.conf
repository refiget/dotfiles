# -- toggle_sync_input
bind C-g if-shell '[[ $(tmux showw synchronize-panes | cut -d\  -f2) == "on" ]]' \
'setw synchronize-panes off; set -g pane-border-style fg=#{?#{!=:#{environ:TMUX_THEME_COLOR},},#{environ:TMUX_THEME_COLOR},#b294bb}' \
'setw synchronize-panes on; set -g pane-border-style fg=red'

# -- theme
if-shell 'uname | grep -q Darwin' {
  run-shell "~/.config/tmux/scripts/update_theme_color.sh"
  # Disable pane-top UI (reduces visual split line)
  setw -g pane-border-status off
  set -g pane-border-style fg=colour244
  # Pane top title (IDE-like): active shows full (dir · git · cmd), inactive is quieter (dir · cmd)
  # Keep formatting simple for compatibility; style emphasis comes primarily from color.
  # Pane top title: no leading space inside #() (tmux can be picky); quote args safely.
  # Pane titles should be static; do not use mode accent here.
  setw -g pane-border-format '#{?pane_active,#[bg=#{@pane_title_bg},fg=colour252]▸ #(/Users/bob/.config/tmux/scripts/pane_starship_title.sh #{pane_pid} #{pane_width} #{q:pane_current_path} #{q:pane_current_command} active)#[default],#[fg=colour244]  #(/Users/bob/.config/tmux/scripts/pane_starship_title.sh #{pane_pid} #{pane_width} #{q:pane_current_path} #{q:pane_current_command} inactive)}'

  set -g status-style "bg=default,fg=#c5c8c6"
  # Center the tab strip for a more "browser tabs" feel
  set -g status-justify 'centre'
  set -g status-left-length 90
  set -g status-right-length 140
  # Timer dot animation needs frequent refresh (kept lightweight)
  set -g status-interval 1

  # UI constants
  # Catppuccin Mocha-ish backgrounds
  set -g @tab_bg "#1e1e2e"
  # Pane title card background (mantle)
  set -g @pane_title_bg "#181825"

  # Window list (tabs): clear boundaries + consistent padding
  setw -g window-status-separator ' │ '
  set -g window-status-style "bg=default"
  set -g window-status-current-style "bg=default"

  # Inactive tabs: truncated + subdued
  # Add a special style for the *last* window (window_last_flag) to aid quick toggling.
  # Last tab: use a very subtle background (more "tab UI" than underline)
  set -g window-status-last-style 'fg=colour252,bg=colour235'
  # Typography: deemphasize the index, keep the name readable
  setw -g window-status-format '#[fg=colour240]  #I:#[fg=colour242]#{=16:#{window_name}}#{?window_activity_flag,#[fg=#ffb86c] •#[fg=colour242],}#{?window_bell_flag,#[fg=#ff5555,bold] !#[fg=colour242],}#{?window_zoomed_flag,#[fg=#{@theme_color},bold] Z#[fg=colour242],}  '

  # Active tab: marker + window name + badges (no cwd)
  # Typography: deemphasize index inside the pill; keep the name as the focus.
  # NOTE: avoid combining ",bold" inside the same #[..] block; on some tmux builds it can leak as literal text.
  # Active tab should be static (no mode accent); focus comes from shape + contrast.
  setw -g window-status-current-format '#[fg=colour252,bg=#{@tab_bg}]#[bold]▏  ▸ #[fg=colour240,bg=#{@tab_bg}]#I:#[fg=colour252,bg=#{@tab_bg}]#{=18:#{window_name}}#{?window_active,,#{?window_activity_flag,#[fg=#ffb86c,bg=#{@tab_bg}] •,}}#{?window_active,,#{?window_bell_flag,#[fg=#ff5555,bg=#{@tab_bg}]#[bold] !,}}#{?window_zoomed_flag,#[fg=colour252,bg=#{@tab_bg}]#[bold] Z,}  ▕#[default]'

  # Activity/bell: use foreground cues (avoid dark background blocks on transparent themes)
  setw -g window-status-activity-style "fg=#ffb86c"
  setw -g window-status-bell-style "fg=#ff5555,bold"
  set-option -g status-left "#(~/.config/tmux/tmux-status/left.sh)  "
  # Right side: keep it stable (no conditional segments that shift centering)
  set-option -g status-right "#(~/.config/tmux/tmux-status/right.sh)"

  # Pomodoro: start 30min timer (Shortcut) and show breathing dot until it ends
  # Uses @pomo_until_epoch (unix seconds). Shortcut name: 30min Timer(confetti)
  bind-key t run-shell -b 'tmux set -g @pomo_until_epoch "$(( $(date +%s) + 1800 ))"; shortcuts run "30min Timer(confetti)" >/dev/null 2>&1 || true; tmux refresh-client -S'
  bind-key T run-shell -b 'tmux set -gu @pomo_until_epoch >/dev/null 2>&1 || true; tmux refresh-client -S'

} {
  run-shell "~/.config/tmux/scripts/update_theme_color.sh"

  setw -g pane-border-status off
  set -g pane-border-style fg=colour244

  set -g status-style "bg=default,fg=#c5c8c6"
  set -g status-justify 'left'
  set -g status-left-length 90
  set -g status-right-length 0
  setw -g window-status-separator ''
  set -g window-status-style "bg=default"
  set -g window-status-current-style "bg=default"
  setw -g window-status-format '#[fg=#c5c8c6] #I:#W '
  setw -g window-status-current-format '#[fg=#{@theme_color},bold] #I:#W '
  setw -g window-status-activity-style "fg=#{@theme_color}"
  setw -g window-status-bell-style "fg=#ff5555"
  set-option -g status-left "#(~/.config/tmux/tmux-status/left.sh) "
  set-option -g status-right ""

  unbind -n M-v
  unbind -n M-h
  unbind -n M-j
  unbind -n M-k
  unbind -n M-l
  bind v copy-mode \; send-keys -X begin-selection
  bind V copy-mode \; send-keys -X rectangle-toggle
  bind P run-shell "~/.config/tmux/scripts/paste_from_clipboard.sh"
}
