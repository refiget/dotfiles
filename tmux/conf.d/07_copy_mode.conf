# -- copy-mode settings
set -g status-keys emacs
set -g mode-keys vi

bind -n M-v if-shell -F '#{==:#{@control_target},remote}' 'send-keys M-v' 'copy-mode'

bind -T copy-mode-vi v send-keys -X begin-selection
bind -T copy-mode-vi C-v send-keys -X rectangle-toggle
bind -T copy-mode-vi h send-keys -X cursor-left
bind -T copy-mode-vi l send-keys -X cursor-right
bind -T copy-mode-vi k send-keys -X cursor-up
bind -T copy-mode-vi j send-keys -X cursor-down
bind -T copy-mode-vi K send-keys -N 5 -X cursor-up
bind -T copy-mode-vi J send-keys -N 5 -X cursor-down
bind -T copy-mode-vi 0 send-keys -X start-of-line
bind -T copy-mode-vi \$ send-keys -X end-of-line
bind -T copy-mode-vi e send-keys -X next-word-end

# y: copy selection to tmux buffer, but STAY in copy-mode.
# This exits the selection highlight so you can start a new selection immediately.
bind -T copy-mode-vi y send-keys -X copy-selection \; send-keys -X clear-selection

# Enter: copy selection to tmux buffer AND exit copy-mode
bind -T copy-mode-vi Enter send-keys -X copy-selection-and-cancel

# Shift-Y: copy selection to system clipboard (OSC52/pbcopy) but STAY in copy-mode
bind -T copy-mode-vi Y send-keys -X copy-pipe "~/.config/tmux/scripts/copy_to_clipboard.sh" \; send-keys -X clear-selection

# P: paste from system clipboard (does not affect copy-mode)
bind -T copy-mode-vi P run -b "~/.config/tmux/scripts/paste_from_clipboard.sh"

# q/Q: exit copy-mode
bind -T copy-mode-vi q send-keys -X cancel
bind -T copy-mode-vi Q send-keys -X cancel
bind -T copy-mode-vi n send-keys -X search-again
bind -T copy-mode-vi N send-keys -X search-reverse

bind b choose-buffer
bind p paste-buffer
bind B run-shell "tmux choose-buffer 'run-shell \"tmux show-buffer -b %% | less -R\"'"

unbind -T copy-mode-vi C-u
unbind -T copy-mode-vi C-e
bind -T copy-mode-vi C-u send-keys -N 5 -X scroll-up
bind -T copy-mode-vi C-e send-keys -N 5 -X scroll-down
